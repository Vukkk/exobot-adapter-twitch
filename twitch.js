require("source-map-support").install();
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("@exoplay/exobot"),require("tmi.js")):"function"==typeof define&&define.amd?define(["@exoplay/exobot","tmi.js"],e):"object"==typeof exports?exports["twitch.js"]=e(require("@exoplay/exobot"),require("tmi.js")):t["twitch.js"]=e(t["@exoplay/exobot"],t["tmi.js"])}(this,function(t,e){return function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var n={};return e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,e,n){Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=2)}([function(t,e){t.exports=require("@exoplay/exobot")},function(t,e){t.exports=require("tmi.js")},function(t,e,n){"use strict";function r(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,n){function r(o,i){try{var c=e[o](i),u=c.value}catch(a){return void n(a)}return c.done?void t(u):Promise.resolve(u).then(function(t){return r("next",t)},function(t){return r("throw",t)})}return r("next")})}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var u=n(1),a=u&&u.__esModule?function(){return u["default"]}:function(){return u};n.d(a,"a",a);var s=n(0),h=s&&s.__esModule?function(){return s["default"]}:function(){return s};n.d(h,"a",h),n.d(e,"EVENTS",function(){return l}),n.d(e,"TwitchAdapter",function(){return w});var p=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),f=function d(t,e,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,e);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:d(o,e,n)}if("value"in r)return r.value;var i=r.get;if(void 0!==i)return i.call(n)},l={connecting:"twitchConnecting",connected:"twitchConnected",logon:"twitchLogon",disconnected:"twitchDisconnected",reconnect:"twitchReconnect",chat:"twitchChat",emoteonly:"twitchEmoteonly",join:"twitchJoin",part:"twitchPart",mods:"twitchMods",notice:"twitchNotice",ping:"twitchPing",pong:"twitchPong",roomstate:"twitchRoomstate",slowmode:"twitchSlowmode",subscribers:"twitchSubscribers",subscription:"twitchSubscription",timeout:"twitchTimeout",whisper:"twitchWhisper"},w=function(t){function e(t){var n=t.username,r=t.oauthPassword,c=t.channels,u=void 0===c?[]:c,a=t.adapterName;o(this,e);var h=i(this,Object.getPrototypeOf(e).apply(this,arguments));return h.name="Twitch",h.twitchConnecting=function(){h.status=s.Adapter.STATUS.CONNECTING},h.twitchConnected=function(){h.status=s.Adapter.STATUS.CONNECTED,h.bot.emitter.emit("connected",h.id),h.bot.log.notice("Connected to Twitch as "+h.username)},h.twitchLogon=function(){h.status=s.Adapter.STATUS.CONNECTED,h.bot.log.notice("Successfully logged on to Twitch as "+h.username)},h.twitchDisconnected=function(){h.status=s.Adapter.STATUS.DISCONNECTED,h.bot.log.warning("Disconnected from Twitch.")},h.twitchReconnect=function(){h.status=s.Adapter.STATUS.RECONNECTING,h.bot.log.notice("Reconnecting to Twitch.")},h.twitchEmoteonly=function(){},h.twitchPing=function(){h.ping()},h.twitchPong=function(){},h.twitchRoomstate=function(){},h.twitchSlowmode=function(){},h.twitchSubscribers=function(){},h.twitchSubscription=function(){},h.twitchTimeout=function(){},h.twitchMods=function(){},h.twitchNotice=function(){},h.username=n,h.oauthPassword=r,h.channels=u,h.name=a||h.name,h}return c(e,t),p(e,[{key:"register",value:function(t){var n=this;f(Object.getPrototypeOf(e.prototype),"register",this).apply(this,arguments);var r=this.username,o=this.oauthPassword,i=this.channels;return r&&o?(i.length||t.log.critical("No channels passed to Twitch adapter to connect to."),this.client=new a.a.client({channels:i,identity:{username:r,password:o},options:{debug:!0},secure:!0,reconnect:!0,logger:{info:t.log.info.bind(t.log),warn:t.log.warning.bind(t.log),error:t.log.error.bind(t.log)},connection:{cluster:"aws"}}),this.client.connect(),void Object.keys(l).forEach(function(t){var e=n[l[t]];n.client.on(t,function(){return e.bind(n).apply(void 0,arguments)}),n.client.on(t,function(){for(var e,r=arguments.length,o=Array(r),i=0;i<r;i++)o[i]=arguments[i];(e=n.bot.emitter).emit.apply(e,["twitch-"+t].concat(o))})})):void t.log.error("username and oauthPassword are required to connect to Twitch.")}},{key:"send",value:function(t){return this.bot.log.debug("Sending "+t.text+" to "+t.channel),t.whisper?this.client.whisper(t.user.name,t.text):void this.client.say(t.channel,t.text)}},{key:"twitchChat",value:function(){function t(t,n,r,o){return e.apply(this,arguments)}var e=r(regeneratorRuntime.mark(function n(t,e,r,o){var i;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!o){n.next=2;break}return n.abrupt("return");case 2:return n.prev=2,n.next=5,this.getUser(e.username,e.username,e);case 5:i=n.sent,this.receive({user:i,text:r,channel:t}),n.next=12;break;case 9:n.prev=9,n.t0=n["catch"](2),this.bot.log.warn(n.t0);case 12:case"end":return n.stop()}},n,this,[[2,9]])}));return t}()},{key:"twitchJoin",value:function(){function t(t,n){return e.apply(this,arguments)}var e=r(regeneratorRuntime.mark(function n(t,e){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(e===this.username){n.next=2;break}return n.abrupt("return");case 2:return n.prev=2,n.next=5,this.getUser(e,e);case 5:return r=n.sent,n.abrupt("return",this.enter({user:r,channel:t}));case 9:n.prev=9,n.t0=n["catch"](2),this.bot.log.warn(n.t0);case 12:case"end":return n.stop()}},n,this,[[2,9]])}));return t}()},{key:"twitchPart",value:function(){function t(t,n){return e.apply(this,arguments)}var e=r(regeneratorRuntime.mark(function n(t,e){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(e===this.username){n.next=2;break}return n.abrupt("return");case 2:return n.prev=2,n.next=5,this.getUser(e,e);case 5:return r=n.sent,n.abrupt("return",this.leave({user:r,channel:t}));case 9:n.prev=9,n.t0=n["catch"](2),this.bot.log.warn(n.t0);case 12:case"end":return n.stop()}},n,this,[[2,9]])}));return t}()},{key:"twitchWhisper",value:function(){function t(t,n,r,o){return e.apply(this,arguments)}var e=r(regeneratorRuntime.mark(function n(t,e,r,o){var i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!o){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,t.next=5,this.getUser(e.username,e.username,e);case 5:i=t.sent,this.receiveWhisper({user:i,text:r,channel:e.username}),t.next=12;break;case 9:t.prev=9,t.t0=t["catch"](2),this.bot.log.warn(t.t0);case 12:case"end":return t.stop()}},n,this,[[2,9]])}));return t}()},{key:"getUserIdByUserName",value:function(){function t(t){return e.apply(this,arguments)}var e=r(regeneratorRuntime.mark(function n(t){var e;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return e=void 0,n.prev=1,n.next=4,this.getUser(t,t);case 4:e=n.sent,n.next=10;break;case 7:n.prev=7,n.t0=n["catch"](1),this.bot.log.warn(n.t0);case 10:return n.abrupt("return",e.id);case 11:case"end":return n.stop()}},n,this,[[1,7]])}));return t}()},{key:"getRolesForUser",value:function(t){var e=this;return this.roleMapping&&this.adapterUsers&&this.adapterUsers[t]?this.adapterUsers[t].roles.filter(function(t){return e.roleMapping[t]}).map(function(t){return e.roleMapping[t]}):[]}},{key:"getRoles",value:function(t,e){var n=[];return!!e&&(e.subscriber===!0&&n.push("subscriber"),e.mod===!0&&n.push("mod"),e.turbo===!0&&n.push("turbo"),n)}}]),e}(s.Adapter)}])});
//# sourceMappingURL=twitch.js.map